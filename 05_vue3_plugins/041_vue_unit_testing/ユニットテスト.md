# ユニットテスト（Jest と vue-test-utils）

関数やストアやコンポーネントの単体テストを Jest と Vue-test-utils を組み合わせて行うことができる。Vue3 のコンポーネントのテストは Vue3 用の vue-test-utils を使う。

- [jest](https://jestjs.io/ja/) (V.27.1)
- [vue-test-utils](https://vue-test-utils.vuejs.org/ja/) (V.2.0.0-0)

どうやら vue-test-utils を使うときは素の jest ではなく vue-jest を使うようだ（vue-jest は jest を使うのだろうが）。

- [vue-jest]() (V.5.0.0)

## インストール

### Vue-cli のとき

**Unit Testing** にチェックを入れると **Mocha + Chai** と **Jest** のどちらを使うか聞かれるので **Jest** を選ぶと対応したツールと設定がインストールされる。

### Vite のとき

Vite では、自前でインストールする必要がある。以下のようにする。インストール後に何の設定ファイルも作成されないで、Vue-cli の作成したものを参考にするかサイトの情報を見て自分で作成する。

```shell
yarn add @vue/test-utils@next vue-jest@5 --dev
```

### 設定

Vue-cli のときは、モジュールのインストールのほか以下の設定が行われる。

#### jest.config.js

```js
module.exports = {
  preset: "@vue/cli-plugin-unit-jest",
  transform: {
    "^.+\\.vue$": "vue-jest"
  }
}
```

#### .eslintrc.js

.eslintrc.js に以下のエントリーが追加される。

```js
overrides: [
  {
    files: ["**/__tests__/*.{j,t}s?(x)", "**/tests/unit/**/*.spec.{j,t}s?(x)"],
    env: {
      jest: true
    }
  }
]
```

#### tests フォルダ

プロジェクトフォルダの直下に**tests**フォルダが作成され、さらにその下にユニットテストプログラム格納用フォルダ**unit**が作成される。そこに、親切なことにサンプルテストプログラム example.spec.js が格納されている。

```js
import { shallowMount } from "@vue/test-utils"
import HelloWorld from "@/components/HelloWorld.vue"

describe("HelloWorld.vue", () => {
  it("renders props.msg when passed", () => {
    const msg = "new message"
    const wrapper = shallowMount(HelloWorld, {
      props: { msg }
    })
    expect(wrapper.text()).toMatch(msg)
  })
})
```

#### テストプログラムの実行

プロジェクトフォルダで以下のコマンドを入力するとサンプルテストプログラムが実行される。

```shell
yarn run unit:test
```

## 参照

[Vue.js テストハンドブック](https://lmiller1990.github.io/vue-testing-handbook/ja/#vue-js%E3%83%86%E3%82%B9%E3%83%88%E3%83%8F%E3%83%B3%E3%83%89%E3%83%96%E3%83%83%E3%82%AF)

以上
